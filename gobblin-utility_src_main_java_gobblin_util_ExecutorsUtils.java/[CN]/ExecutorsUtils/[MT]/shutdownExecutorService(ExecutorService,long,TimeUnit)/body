{
  Preconditions.checkNotNull(unit);
  executorService.shutdown();
  try {
    long halfTimeoutNanos=TimeUnit.NANOSECONDS.convert(timeout,unit) / 2;
    if (!executorService.awaitTermination(halfTimeoutNanos,TimeUnit.NANOSECONDS)) {
      executorService.shutdownNow();
      executorService.awaitTermination(halfTimeoutNanos,TimeUnit.NANOSECONDS);
    }
  }
 catch (  InterruptedException ie) {
    Thread.currentThread().interrupt();
    executorService.shutdownNow();
  }
}
