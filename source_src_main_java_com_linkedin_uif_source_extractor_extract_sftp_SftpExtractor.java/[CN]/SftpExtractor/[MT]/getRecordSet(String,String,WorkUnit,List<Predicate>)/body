{
  try {
    log.info("Fetching record set");
    List<Command> cmds=this.getDataMetadata(schema,entity,workUnit,predicateList);
    if (cmds == null || cmds.isEmpty()) {
      return null;
    }
    for (    Command cmd : cmds) {
      if (cmd instanceof SftpCommand) {
        SftpCommand sftpCmd=(SftpCommand)cmd;
        if (sftpCmd.getCommandType().equals(SftpCommandType.GET_FILE)) {
          executor.executeGetFileCommand(sftpCmd,this.channelSftp,this.workUnit.getProp(ConfigurationKeys.WRITER_FILE_SYSTEM_URI));
        }
 else         if (sftpCmd.getCommandType().equals(SftpCommandType.GET_STREAM)) {
          InputStream stream=executor.executeGetStreamCommand(sftpCmd,this.channelSftp);
          CommandOutput<SftpCommand,InputStream> getStreamOutput=new SftpGetCommandOuput();
          getStreamOutput.put(sftpCmd,stream);
          return this.getData(getStreamOutput);
        }
 else {
          SftpExecutor.executeUnixCommand(sftpCmd,this.channelSftp);
        }
      }
 else {
        throw new DataRecordException("Illegal command given to getRecordSet()");
      }
    }
    return this.getData(new SftpCommandOutput());
  }
 catch (  SftpException e) {
    throw new DataRecordException(e.getMessage(),e);
  }
catch (  SftpCommandFormatException e) {
    throw new DataRecordException(e.getMessage(),e);
  }
}
