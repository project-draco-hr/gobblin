{
  DataFileReader<GenericRecord> dfr=null;
  try {
    if (state.getPropAsBoolean(ConfigurationKeys.SHOULD_FS_PROXY_AS_USER,ConfigurationKeys.DEFAULT_SHOULD_FS_PROXY_AS_USER)) {
      dfr=new DataFileReader<GenericRecord>(new ProxyFsInput(new Path(file),this.fs),new GenericDatumReader<GenericRecord>());
    }
 else {
      dfr=new DataFileReader<GenericRecord>(new FsInput(new Path(file),fs.getConf()),new GenericDatumReader<GenericRecord>());
    }
    return dfr.getSchema();
  }
 catch (  IOException e) {
    throw new FileBasedHelperException("Failed to open avro file " + file + " due to error "+ e.getMessage(),e);
  }
 finally {
    if (dfr != null) {
      try {
        dfr.close();
      }
 catch (      IOException e) {
        LOGGER.error("Failed to close avro file " + file,e);
      }
    }
  }
}
