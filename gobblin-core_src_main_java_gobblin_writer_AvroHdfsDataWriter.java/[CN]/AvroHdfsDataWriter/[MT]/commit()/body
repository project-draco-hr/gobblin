{
  if (!this.closed) {
    this.close();
  }
  if (!this.fs.exists(this.stagingFile)) {
    throw new IOException(String.format("File %s does not exist",this.stagingFile));
  }
  LOG.info(String.format("Moving data from %s to %s",this.stagingFile,this.outputFile));
  if (this.fs.exists(this.outputFile)) {
    LOG.warn(String.format("Task output file %s already exists",this.outputFile));
    this.fs.delete(this.outputFile,false);
  }
  if (!this.fs.rename(this.stagingFile,this.outputFile)) {
    throw new IOException("Failed to commit data from " + this.stagingFile + " to "+ this.outputFile);
  }
  if (properties.contains(ConfigurationKeys.HDFS_FILE_REPLICATION_FACTOR)) {
    fs.setReplication(outputFile,(short)properties.getPropAsInt(ConfigurationKeys.HDFS_FILE_REPLICATION_FACTOR));
  }
  if (properties.contains(ConfigurationKeys.HDFS_FILE_PERMISSIONS)) {
    short permissions=(short)properties.getPropAsInt(ConfigurationKeys.HDFS_FILE_PERMISSIONS);
    fs.setPermission(outputFile,new FsPermission(permissions));
  }
  if (properties.contains(ConfigurationKeys.HDFS_FILE_OWNER) && properties.contains(ConfigurationKeys.HDFS_FILE_GROUP)) {
    fs.setOwner(outputFile,properties.getProp(ConfigurationKeys.HDFS_FILE_OWNER),properties.getProp(ConfigurationKeys.HDFS_FILE_GROUP));
  }
}
