{
  super(properties);
  String uri=properties.getProp(ForkOperatorUtils.getPropertyNameForBranch(ConfigurationKeys.WRITER_FILE_SYSTEM_URI,numBranches,branchId),ConfigurationKeys.LOCAL_FS_URI);
  Path stagingDir=WriterUtils.getWriterStagingDir(properties,numBranches,branchId);
  Path outputDir=WriterUtils.getWriterOutputDir(properties,numBranches,branchId);
  String codecType=properties.getProp(ForkOperatorUtils.getPropertyNameForBranch(ConfigurationKeys.WRITER_CODEC_TYPE,numBranches,branchId),AvroHdfsDataWriter.CodecType.DEFLATE.name());
  int bufferSize=Integer.parseInt(properties.getProp(ForkOperatorUtils.getPropertyNameForBranch(ConfigurationKeys.WRITER_BUFFER_SIZE,numBranches,branchId),ConfigurationKeys.DEFAULT_BUFFER_SIZE));
  int deflateLevel=Integer.parseInt(properties.getProp(ForkOperatorUtils.getPropertyNameForBranch(ConfigurationKeys.WRITER_DEFLATE_LEVEL,numBranches,branchId),ConfigurationKeys.DEFAULT_DEFLATE_LEVEL));
  this.properties=properties;
  this.schema=schema;
  Configuration conf=new Configuration();
  for (  String key : properties.getPropertyNames()) {
    conf.set(key,properties.getProp(key));
  }
  this.fs=FileSystem.get(URI.create(uri),conf);
  this.stagingFile=new Path(stagingDir,fileName);
  if (this.fs.exists(this.stagingFile)) {
    LOG.warn(String.format("Task staging file %s already exists, deleting it",this.stagingFile));
    this.fs.delete(this.stagingFile,false);
  }
  this.outputFile=new Path(outputDir,fileName);
  if (!this.fs.exists(this.outputFile.getParent())) {
    this.fs.mkdirs(this.outputFile.getParent());
  }
  this.datumWriter=new GenericDatumWriter<GenericRecord>();
  this.writer=createDatumWriter(this.stagingFile,bufferSize,CodecType.valueOf(codecType),deflateLevel);
}
