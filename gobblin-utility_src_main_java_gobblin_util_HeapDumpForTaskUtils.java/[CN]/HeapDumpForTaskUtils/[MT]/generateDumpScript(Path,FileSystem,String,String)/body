{
  if (fs.exists(dumpScript)) {
    LOG.info("Heap dump script already exists: " + dumpScript);
    return;
  }
  Closer closer=Closer.create();
  try {
    Path dumpDir=new Path(dumpScript.getParent(),DUMP_FOLDER);
    if (!fs.exists(dumpDir)) {
      fs.mkdirs(dumpDir);
    }
    BufferedWriter scriptWriter=closer.register(new BufferedWriter(new OutputStreamWriter(fs.create(dumpScript),Charset.forName(ConfigurationKeys.DEFAULT_CHARSET_ENCODING))));
    scriptWriter.write("#!/bin/sh\n" + "hadoop dfs -put " + heapFileName + " "+ dumpDir+ "/${PWD//\\//_}.hprof");
    scriptWriter.flush();
    Runtime.getRuntime().exec(chmod + " " + dumpScript);
  }
 catch (  IOException e) {
    LOG.error("Heap dump script is not generated successfully.");
    if (fs.exists(dumpScript)) {
      fs.delete(dumpScript,true);
    }
  }
catch (  Throwable t) {
    closer.rethrow(t);
  }
 finally {
    closer.close();
  }
}
