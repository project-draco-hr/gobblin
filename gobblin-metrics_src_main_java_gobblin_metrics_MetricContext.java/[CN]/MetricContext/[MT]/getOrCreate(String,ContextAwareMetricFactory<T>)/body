{
  Metric metric=this.contextAwareMetrics.get(name);
  if (metric != null) {
    if (factory.isInstance(metric)) {
      return (T)metric;
    }
    throw new IllegalArgumentException(name + " is already used for a different type of metric");
  }
  T newMetric=factory.newMetric(this,name);
  register(name,newMetric);
  return newMetric;
}
