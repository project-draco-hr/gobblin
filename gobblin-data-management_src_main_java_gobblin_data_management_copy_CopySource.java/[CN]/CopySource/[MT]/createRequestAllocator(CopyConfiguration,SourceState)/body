{
  Optional<FileSetComparator> prioritizer=copyConfiguration.getPrioritizer();
  if (!prioritizer.isPresent()) {
    return new AllEqualAllocator<>(new FileSetResourceEstimator());
  }
  if (prioritizer.get() instanceof HierarchicalPrioritizer) {
    return new HierarchicalAllocator.Factory().createRequestAllocator((HierarchicalPrioritizer)copyConfiguration.getPrioritizer().get(),new FileSetResourceEstimator(),copyConfiguration.getPrioritizationConfig());
  }
 else {
    return RequestAllocatorUtils.inferFromConfig(prioritizer.get(),new FileSetResourceEstimator(),copyConfiguration.getPrioritizationConfig());
  }
}
