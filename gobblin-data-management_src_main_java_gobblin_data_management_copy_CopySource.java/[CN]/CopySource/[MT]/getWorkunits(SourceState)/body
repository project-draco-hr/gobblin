{
  List<WorkUnit> workUnits=Lists.newArrayList();
  try {
    DatasetFinder<CopyableDataset> datasetFinder=new CopyableDatasetFinder(getSourceFileSystem(state),state.getProperties());
    List<CopyableDataset> copyableDatasets=datasetFinder.findDatasets();
    for (    CopyableDataset copyableDataset : copyableDatasets) {
      Collection<Partition<CopyableFile>> partitions=copyableDataset.partitionFiles(copyableDataset.getCopyableFiles(getTargetFileSystem(state)));
      for (      Partition<CopyableFile> partition : partitions) {
        Extract extract=new Extract(Extract.TableType.SNAPSHOT_ONLY,"gobblin.copy",partition.getName());
        for (        CopyableFile copyableFile : partition.getFiles()) {
          WorkUnit workUnit=new WorkUnit(extract);
          workUnit.addAll(state);
          workUnit.setProp(ForkOperatorUtils.getPropertyNameForBranch(ConfigurationKeys.DATA_PUBLISHER_FINAL_DIR,0,0),copyableFile.getDestination().toString());
          state.setProp(CopyableFile.SERIALIZED_COPYABLE_FILE,CopyableFile.serializeCopyableFile(copyableFile));
          workUnits.add(workUnit);
        }
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  return workUnits;
}
