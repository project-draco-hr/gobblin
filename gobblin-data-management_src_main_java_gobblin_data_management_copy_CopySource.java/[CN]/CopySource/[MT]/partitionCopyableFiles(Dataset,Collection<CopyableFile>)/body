{
  Map<String,FileSet.Builder<CopyableFile>> partitionBuildersMaps=Maps.newHashMap();
  for (  CopyableFile file : files) {
    if (!partitionBuildersMaps.containsKey(file.getFileSet())) {
      partitionBuildersMaps.put(file.getFileSet(),new FileSet.Builder<CopyableFile>(file.getFileSet(),dataset));
    }
    partitionBuildersMaps.get(file.getFileSet()).add(file);
  }
  return Lists.newArrayList(Iterables.transform(partitionBuildersMaps.values(),new Function<FileSet.Builder<CopyableFile>,FileSet<CopyableFile>>(){
    @Nullable @Override public FileSet<CopyableFile> apply(    FileSet.Builder<CopyableFile> input){
      return input.build();
    }
  }
));
}
