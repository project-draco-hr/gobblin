{
  try {
    if (!this.isCancelled && this.job != null && !this.job.isComplete()) {
      LOG.info("Killing Hadoop MR job " + this.job.getJobID());
      this.job.killJob();
    }
    this.isCancelled=true;
    LOG.info("Cancelled job " + this.jobProps.getProperty(ConfigurationKeys.JOB_ID_KEY));
    if (jobListener != null) {
      jobListener.onJobCancellation(this.jobState);
    }
  }
 catch (  IOException ioe) {
    LOG.error("Failed to kill the Hadoop MR job " + this.job.getJobID(),ioe);
    throw new JobException("Failed to kill the Hadoop MR job " + this.job.getJobID(),ioe);
  }
 finally {
    cleanUpWorkingDirectory();
  }
}
