{
  long delay=500;
  Properties properties=TestTrash.propertiesForTestTrash();
  TestTrash.simulateDelay(properties,delay);
  FileSystem fs=mock(FileSystem.class);
  AsyncTrash trash=new AsyncTrash(fs,properties);
  long startTime=System.currentTimeMillis();
  for (int i=0; i < 5; i++) {
    trash.moveToTrash(new Path("file" + i));
  }
  for (int i=0; i < 5; i++) {
    trash.moveToTrashAsUser(new Path("file" + i),"user" + i);
  }
  Assert.assertTrue(System.currentTimeMillis() - startTime < delay);
  Assert.assertTrue(((TestTrash)trash.getDecoratedObject()).getDeleteOperations().isEmpty());
  Thread.sleep(2 * delay);
  Assert.assertEquals(((TestTrash)trash.getDecoratedObject()).getDeleteOperations().size(),10);
}
