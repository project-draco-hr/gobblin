{
  List<State> flattenedWorkUnits=Lists.newArrayList();
  for (  State state : states) {
    if (state instanceof MultiWorkUnit) {
      flattenedWorkUnits.addAll(flattenWorkUnits(((MultiWorkUnit)state).getWorkUnits()));
    }
 else {
      flattenedWorkUnits.add(state);
    }
  }
  return flattenedWorkUnits;
}
