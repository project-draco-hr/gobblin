{
  Multimap<CopyableFile.DatasetAndPartition,WorkUnitState> datasets=getDatasetRoots(states);
  boolean allDatasetsPublished=true;
  for (  CopyableFile.DatasetAndPartition datasetAndPartition : datasets.keySet()) {
    try {
      this.publishDataset(datasetAndPartition,datasets.get(datasetAndPartition));
    }
 catch (    Throwable e) {
      CopyEventSubmitterHelper.submitFailedDatasetPublish(eventSubmitter,datasetAndPartition);
      log.error("Failed to publish " + datasetAndPartition.getDataset().getDatasetTargetRoot(),e);
      allDatasetsPublished=false;
    }
  }
  if (!allDatasetsPublished) {
    throw new IOException("Not all datasets published successfully");
  }
}
