{
  Multimap<CopyableFile.DatasetAndPartition,WorkUnitState> datasets=groupByFileSet(states);
  boolean allDatasetsPublished=true;
  for (  CopyableFile.DatasetAndPartition datasetAndPartition : datasets.keySet()) {
    try {
      this.publishFileSet(datasetAndPartition,datasets.get(datasetAndPartition));
    }
 catch (    Throwable e) {
      CopyEventSubmitterHelper.submitFailedDatasetPublish(eventSubmitter,datasetAndPartition);
      log.error("Failed to publish " + datasetAndPartition.getDataset().getDatasetURN(),e);
      allDatasetsPublished=false;
    }
  }
  if (!allDatasetsPublished) {
    throw new IOException("Not all datasets published successfully");
  }
}
