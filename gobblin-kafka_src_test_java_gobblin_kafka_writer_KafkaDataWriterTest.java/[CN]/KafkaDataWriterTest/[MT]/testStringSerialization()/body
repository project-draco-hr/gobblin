{
  Properties props=new Properties();
  props.setProperty(KafkaWriterConfigurationKeys.KAFKA_TOPIC,TOPIC);
  props.setProperty(KafkaWriterConfigurationKeys.KAFKA_PRODUCER_CONFIG_PREFIX + "bootstrap.servers","localhost:" + this.kafkaPort);
  props.setProperty(KafkaWriterConfigurationKeys.KAFKA_PRODUCER_CONFIG_PREFIX + "value.serializer","org.apache.kafka.common.serialization.StringSerializer");
  KafkaDataWriter<String> kafkaWriter=new KafkaDataWriter<String>(props);
  String messageString="foobar";
  try {
    kafkaWriter.write(messageString);
  }
  finally {
    kafkaWriter.close();
  }
  Thread.sleep(500);
  Assert.assertEquals(kafkaWriter.recordsWritten(),1);
  byte[] message=iterator.next().message();
  String messageReceived=new String(message);
  Assert.assertEquals(messageReceived,messageString);
}
