{
  this.logger=LoggerFactory.getLogger(Fork.class.getName() + "-" + index);
  this.taskContext=taskContext;
  this.taskState=taskState;
  this.taskId=taskState.getTaskId();
  this.branches=branches;
  this.index=index;
  this.converter=this.closer.register(new MultiConverter(this.taskContext.getConverters(this.index)));
  this.convertedSchema=Optional.fromNullable(this.converter.convertSchema(schema,this.taskState));
  this.rowLevelPolicyChecker=this.closer.register(this.taskContext.getRowLevelPolicyChecker(this.taskState,this.index));
  this.rowLevelPolicyCheckingResult=new RowLevelPolicyCheckResults();
  this.recordQueue=BoundedBlockingRecordQueue.newBuilder().hasCapacity(taskState.getPropAsInt(ConfigurationKeys.FORK_RECORD_QUEUE_CAPACITY_KEY,ConfigurationKeys.DEFAULT_FORK_RECORD_QUEUE_CAPACITY)).useTimeout(taskState.getPropAsLong(ConfigurationKeys.FORK_RECORD_QUEUE_TIMEOUT_KEY,ConfigurationKeys.DEFAULT_FORK_RECORD_QUEUE_TIMEOUT)).useTimeoutTimeUnit(TimeUnit.valueOf(taskState.getProp(ConfigurationKeys.FORK_RECORD_QUEUE_TIMEOUT_UNIT_KEY,ConfigurationKeys.DEFAULT_FORK_RECORD_QUEUE_TIMEOUT_UNIT))).collectStats().build();
  this.countDownLatch=countDownLatch;
  this.forkState=new AtomicReference<ForkState>(ForkState.PENDING);
}
