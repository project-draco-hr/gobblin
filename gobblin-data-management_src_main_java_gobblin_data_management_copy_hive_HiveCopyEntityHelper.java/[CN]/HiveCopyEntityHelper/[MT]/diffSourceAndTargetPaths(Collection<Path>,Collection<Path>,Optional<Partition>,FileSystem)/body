{
  DiffPathSet.DiffPathSetBuilder builder=DiffPathSet.builder();
  Set<Path> targetPathSet=Sets.newHashSet(targetExistingPaths);
  for (  Path sourcePath : sourcePaths) {
    FileStatus status=this.dataset.fs.getFileStatus(sourcePath);
    Path targetPath=targetFs.makeQualified(getTargetPath(status,this.targetFs,partition));
    if (targetPathSet.contains(targetPath)) {
      FileStatus targetStatus=targetFs.getFileStatus(targetPath);
      if (targetStatus.getLen() != status.getLen() || targetStatus.getModificationTime() < status.getModificationTime()) {
        builder.deleteFile(targetPath);
        builder.copyFile(status);
      }
      targetPathSet.remove(targetPath);
    }
 else {
      builder.copyFile(status);
    }
  }
  for (  Path deletePath : targetPathSet) {
    builder.deleteFile(deletePath);
  }
  return builder.build();
}
