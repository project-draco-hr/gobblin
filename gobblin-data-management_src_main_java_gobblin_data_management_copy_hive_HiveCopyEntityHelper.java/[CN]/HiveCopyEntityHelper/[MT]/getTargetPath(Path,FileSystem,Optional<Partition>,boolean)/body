{
  if (this.relocateDataFiles) {
    Preconditions.checkArgument(this.targetTableRoot.isPresent(),"Must define %s to relocate data files.",COPY_TARGET_TABLE_ROOT);
    Path path=this.targetTableRoot.get();
    if (partition.isPresent()) {
      addPartitionToPath(path,partition.get());
    }
    if (!isConcreteFile) {
      return targetFs.makeQualified(path);
    }
 else {
      return targetFs.makeQualified(new Path(path,sourcePath.getName()));
    }
  }
  if (this.targetTableRoot.isPresent()) {
    Preconditions.checkArgument(this.dataset.tableRootPath.isPresent(),"Cannot move paths to a new root unless table has exactly one location.");
    Preconditions.checkArgument(PathUtils.isAncestor(this.dataset.tableRootPath.get(),sourcePath),"When moving paths to a new root, all locations must be descendants of the table root location. " + "Table root location: %s, file location: %s.",this.dataset.tableRootPath,sourcePath);
    Path relativePath=PathUtils.relativizePath(sourcePath,this.dataset.tableRootPath.get());
    return targetFs.makeQualified(new Path(this.targetTableRoot.get(),relativePath));
  }
 else {
    return targetFs.makeQualified(PathUtils.getPathWithoutSchemeAndAuthority(sourcePath));
  }
}
