{
  if (Type.RECORD.equals(schema.getType())) {
    fqn.addLast(schema.getName());
    for (    Field f : schema.getFields()) {
      fieldsToRemoveHelper(f.schema(),f,requiredFields,fqn,fieldsToRemove);
    }
    fqn.removeLast();
    return fieldsToRemove;
  }
  fqn.addLast(field.name());
  String fqnStr=JOINER_ON_DOT.join(fqn);
  boolean isRequiredField=requiredFields.remove(fqnStr);
  if (!isRequiredField) {
    boolean isFirstRemoval=fieldsToRemove.add(fqnStr);
    if (!isFirstRemoval) {
      throw new SchemaConversionException("Duplicate name " + fqnStr + " is not allowed");
    }
  }
  fqn.removeLast();
  return fieldsToRemove;
}
