{
  log.debug("Getting previous watermark");
  boolean hasDataInPreviousRun=false;
  long latestWaterMark=ConfigurationKeys.DEFAULT_WATERMARK_VALUE;
  List<WorkUnitState> previousWorkUnitStates=state.getPreviousStates();
  List<Long> previousWorkUnitStateHighWatermarks=new ArrayList<Long>();
  List<Long> previousWorkUnitLowWatermarks=new ArrayList<Long>();
  if (previousWorkUnitStates.size() == 0) {
    log.info("Previous states are not found; Latest watermark - Default watermark: " + latestWaterMark);
    return latestWaterMark;
  }
  for (  WorkUnitState workUnitState : previousWorkUnitStates) {
    if (workUnitState.getWorkingState() == WorkingState.COMMITTED) {
      if (workUnitState.getHighWaterMark() != ConfigurationKeys.DEFAULT_WATERMARK_VALUE) {
        hasDataInPreviousRun=true;
      }
      previousWorkUnitStateHighWatermarks.add(workUnitState.getHighWaterMark());
      previousWorkUnitLowWatermarks.add(this.getLowWatermarkFromWorkUnit(workUnitState.getWorkunit(),workUnitState.getProp(ConfigurationKeys.SOURCE_QUERYBASED_WATERMARK_TYPE)));
    }
  }
  if (previousWorkUnitStateHighWatermarks.isEmpty()) {
    latestWaterMark=ConfigurationKeys.DEFAULT_WATERMARK_VALUE;
    log.info("Previous Committed states are not found; Latest watermark - Default watermark: " + latestWaterMark);
  }
 else   if (hasDataInPreviousRun) {
    latestWaterMark=Collections.max(previousWorkUnitStateHighWatermarks);
    log.info("Previous run has data; Latest watermark - Max watermark from WorkUnitStates: " + latestWaterMark);
  }
 else {
    latestWaterMark=Collections.min(previousWorkUnitLowWatermarks);
    log.info("Previous run has no data; Latest watermark - Min watermark from WorkUnits: " + latestWaterMark);
  }
  return latestWaterMark;
}
