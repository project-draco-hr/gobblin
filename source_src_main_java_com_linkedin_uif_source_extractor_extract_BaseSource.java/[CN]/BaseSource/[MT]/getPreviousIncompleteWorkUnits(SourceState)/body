{
  log.debug("Getting previous unsuccessful work units");
  List<WorkUnit> previousWorkUnits=new ArrayList<WorkUnit>();
  List<WorkUnitState> previousWorkUnitStates=state.getPreviousStates();
  if (previousWorkUnitStates.size() == 0) {
    log.debug("Previous states are not found");
    return previousWorkUnits;
  }
  for (  WorkUnitState workUnitState : previousWorkUnitStates) {
    JobCommitPolicy commitPolicy=JobCommitPolicy.forName(workUnitState.getWorkunit().getProp(ConfigurationKeys.JOB_COMMIT_POLICY_KEY,ConfigurationKeys.DEFAULT_JOB_COMMIT_POLICY));
    if (commitPolicy == JobCommitPolicy.COMMIT_ON_PARTIAL_SUCCESS && (workUnitState.getWorkingState() == WorkingState.FAILED || workUnitState.getWorkingState() == WorkingState.ABORTED)) {
      previousWorkUnits.add(workUnitState.getWorkunit());
    }
  }
  return previousWorkUnits;
}
