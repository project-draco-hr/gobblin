{
  UserGroupInformation.createProxyUser(userToProxy,UserGroupInformation.getLoginUser()).doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      getToken(userToProxy);
      return null;
    }
    private void getToken(    String userToProxy) throws InterruptedException, IOException {
      getHdfsToken(conf,userToProxy,cred);
      if (state.contains(OTHER_NAMENODES)) {
        getOtherNamenodesToken(state.getPropAsList(OTHER_NAMENODES),conf,userToProxy,cred);
      }
      getJtToken(userToProxy,cred);
    }
  }
);
}
