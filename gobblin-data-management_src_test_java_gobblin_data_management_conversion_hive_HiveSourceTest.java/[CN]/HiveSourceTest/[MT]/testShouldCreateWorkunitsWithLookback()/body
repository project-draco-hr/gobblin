{
  DateTimeUtils.setCurrentMillisProvider(new FixedThreadLocalMillisProvider(new DateTime(2016,6,20,0,0,0,0).getMillis()));
  long currentTime=System.currentTimeMillis();
  long watermarkTime=new DateTime(currentTime).minusDays(2).getMillis();
  SourceState testState=getTestState("testdb5");
  testState.setProp(HiveSource.HIVE_SOURCE_MAXIMUM_LOOKBACK_DAYS_KEY,10);
  HiveSource source=new HiveSource();
  source.initialize(testState);
  LongWatermark mockLongWatermark=new LongWatermark(watermarkTime);
  boolean shouldCreate=source.shouldCreateWorkunitForPartition(DatePatternUpdateProviderTest.createMockPartitionWithLocation("/daily/2016/06/15"),currentTime,mockLongWatermark);
  Assert.assertEquals(shouldCreate,true);
  shouldCreate=source.shouldCreateWorkunitForPartition(DatePatternUpdateProviderTest.createMockPartitionWithLocation("/daily/2016/06/09"),currentTime,mockLongWatermark);
  Assert.assertEquals(shouldCreate,false,"Should not create workunit for partition older than 10 days");
  DateTimeUtils.setCurrentMillisSystem();
}
