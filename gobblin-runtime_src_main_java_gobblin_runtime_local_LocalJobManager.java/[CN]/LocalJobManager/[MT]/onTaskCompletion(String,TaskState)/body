{
  if (!this.jobStateMap.containsKey(jobId)) {
    LOG.error(String.format("Job %s could not be found",jobId));
    return;
  }
  if (JobMetrics.isEnabled(this.properties)) {
    taskState.removeMetrics();
  }
  JobState jobState=this.jobStateMap.get(jobId);
  jobState.addTaskState(taskState);
  if (jobState.getCompletedTasks() == jobState.getTasks()) {
    LOG.info(String.format("All tasks of job %s have completed, committing it",jobId));
    String jobName=taskState.getWorkunit().getProp(ConfigurationKeys.JOB_NAME_KEY);
    try {
      commitJob(jobId,jobName,getFinalJobState(jobState));
    }
 catch (    Throwable t) {
      LOG.error("Failed to commit job " + jobId,t);
    }
  }
}
