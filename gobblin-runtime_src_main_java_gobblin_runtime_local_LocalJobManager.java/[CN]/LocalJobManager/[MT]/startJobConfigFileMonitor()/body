{
  File jobConfigFileDir=new File(this.properties.getProperty(ConfigurationKeys.JOB_CONFIG_FILE_DIR_KEY));
  FileAlterationObserver observer=new FileAlterationObserver(jobConfigFileDir);
  FileAlterationListener listener=new FileAlterationListenerAdaptor(){
    /** 
 * Called when a new job configuration file is dropped in.
 */
    @Override public void onFileCreate(    File file){
      int pos=file.getName().lastIndexOf(".");
      String fileExtension=pos >= 0 ? file.getName().substring(pos + 1) : "";
      if (!jobConfigFileExtensions.contains(fileExtension)) {
        return;
      }
      LOG.info("Detected new job configuration file " + file.getAbsolutePath());
      Properties jobProps=new Properties();
      jobProps.putAll(properties);
      loadJobConfig(jobProps,file);
      try {
        boolean runOnce=Boolean.valueOf(jobProps.getProperty(ConfigurationKeys.JOB_RUN_ONCE_KEY,"false"));
        scheduleJob(jobProps,runOnce ? new RunOnceJobListener() : new EmailNotificationJobListener());
      }
 catch (      Throwable t) {
        LOG.error("Failed to schedule new job loaded from job configuration file " + file.getAbsolutePath(),t);
      }
    }
    /** 
 * Called when a job configuration file is changed.
 */
    @Override public void onFileChange(    File file){
      int pos=file.getName().lastIndexOf(".");
      String fileExtension=pos >= 0 ? file.getName().substring(pos + 1) : "";
      if (!jobConfigFileExtensions.contains(fileExtension)) {
        return;
      }
      LOG.info("Detected change to job configuration file " + file.getAbsolutePath());
      Properties jobProps=new Properties();
      jobProps.putAll(properties);
      loadJobConfig(jobProps,file);
      String jobName=jobProps.getProperty(ConfigurationKeys.JOB_NAME_KEY);
      try {
        unscheduleJob(jobName);
        boolean runOnce=Boolean.valueOf(jobProps.getProperty(ConfigurationKeys.JOB_RUN_ONCE_KEY,"false"));
        scheduleJob(jobProps,runOnce ? new RunOnceJobListener() : new EmailNotificationJobListener());
      }
 catch (      Throwable t) {
        LOG.error("Failed to update existing job " + jobName,t);
      }
    }
    private void loadJobConfig(    Properties jobProps,    File file){
      Closer closer=Closer.create();
      try {
        Reader propsReader=closer.register(new InputStreamReader(new FileInputStream(file),ConfigurationKeys.DEFAULT_CHARSET_ENCODING));
        jobProps.load(propsReader);
        jobProps.setProperty(ConfigurationKeys.JOB_CONFIG_FILE_PATH_KEY,file.getAbsolutePath());
      }
 catch (      Exception e) {
        LOG.error("Failed to load job configuration from file " + file.getAbsolutePath(),e);
      }
 finally {
        try {
          closer.close();
        }
 catch (        IOException e) {
          LOG.error("unable to close properties file:" + e,e);
        }
      }
    }
  }
;
  observer.addListener(listener);
  this.fileAlterationMonitor.addObserver(observer);
  this.fileAlterationMonitor.start();
}
