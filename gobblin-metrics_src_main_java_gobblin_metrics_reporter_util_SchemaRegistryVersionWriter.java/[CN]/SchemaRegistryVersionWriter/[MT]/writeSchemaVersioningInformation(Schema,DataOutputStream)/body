{
  if (!this.registrySchemaIds.containsKey(schema)) {
    try {
      String schemaId=this.registry.register(schema,this.topic);
      this.registrySchemaIds.put(schema,schemaId);
    }
 catch (    SchemaRegistryException e) {
      throw Throwables.propagate(e);
    }
  }
  outputStream.writeByte(KafkaAvroSchemaRegistry.MAGIC_BYTE);
  try {
    outputStream.write(Hex.decodeHex(this.registrySchemaIds.get(schema).toCharArray()));
  }
 catch (  DecoderException exception) {
    throw new IOException(exception);
  }
}
