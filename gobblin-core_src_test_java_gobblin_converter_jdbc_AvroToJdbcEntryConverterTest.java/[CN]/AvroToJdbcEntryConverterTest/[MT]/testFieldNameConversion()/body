{
  Map<String,JDBCType> dateColums=new HashMap<>();
  dateColums.put("last_updated",JDBCType.TIMESTAMP);
  final String table="users";
  JdbcWriterCommands mockWriterCommands=mock(JdbcWriterCommands.class);
  when(mockWriterCommands.retrieveDateColumns(mock(Connection.class),table)).thenReturn(dateColums);
  JdbcWriterCommandsFactory factory=mock(JdbcWriterCommandsFactory.class);
  when(factory.newInstance(any(State.class))).thenReturn(mockWriterCommands);
  WorkUnitState workUnitState=new WorkUnitState();
  workUnitState.appendToListProp(ConfigurationKeys.JDBC_PUBLISHER_FINAL_TABLE_NAME,table);
  String fieldPairJson="{\"userId\":\"user_id\" , \"memberId\":\"member_id\" , \"businessUnit\":\"business_unit\", \"geoRegion\":\"geo_region\", \"superRegion\":\"super_region\", \"subRegion\":\"sub_region\"}";
  workUnitState.appendToListProp(ConfigurationKeys.CONVERTER_AVRO_JDBC_ENTRY_FIELDS_PAIRS,fieldPairJson);
  workUnitState.appendToListProp(ConfigurationKeys.WRITER_DESTINATION_TYPE_KEY,DestinationType.MYSQL.name());
  AvroToJdbcEntryConverter converter=new AvroToJdbcEntryConverter(workUnitState,factory);
  converter=spy(converter);
  doReturn(null).when(converter).createConnection(workUnitState);
  when(converter.createConnection(workUnitState)).thenReturn(null);
  Schema inputSchema=new Schema.Parser().parse(new File(PATH_PREFIX + "/converter/user.avsc"));
  List<JdbcEntryMetaDatum> jdbcEntryMetaData=new ArrayList<>();
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("user_id",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("member_id",JDBCType.BIGINT));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("business_unit",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("level",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("geo_region",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("super_region",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("sub_region",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("currency",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("segment",JDBCType.VARCHAR));
  jdbcEntryMetaData.add(new JdbcEntryMetaDatum("vertical",JDBCType.VARCHAR));
  JdbcEntrySchema expected=new JdbcEntrySchema(jdbcEntryMetaData);
  JdbcEntrySchema actual=converter.convertSchema(inputSchema,workUnitState);
  Assert.assertEquals(expected,actual);
}
