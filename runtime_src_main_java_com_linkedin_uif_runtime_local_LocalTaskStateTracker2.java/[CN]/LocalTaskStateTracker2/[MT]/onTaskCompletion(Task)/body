{
  if (JobMetrics.isEnabled(task.getTaskState().getWorkunit())) {
    task.updateRecordMetrics();
    task.updateByteMetrics();
    task.getTaskState().removeMetrics();
  }
  if (this.scheduledReporters.containsKey(task.getTaskId())) {
    this.scheduledReporters.remove(task.getTaskId()).cancel(false);
  }
  WorkUnitState.WorkingState state=task.getTaskState().getWorkingState();
  if (state == WorkUnitState.WorkingState.FAILED && task.getRetryCount() < this.maxTaskRetries) {
    this.taskExecutor.retry(task);
    return;
  }
  task.markTaskCompletion();
  LOG.info(String.format("Task %s completed in %dms with state %s",task.getTaskId(),task.getTaskState().getTaskDuration(),state));
}
