{
  if (state.contains(KAFKA_WORKUNIT_PACKER_TYPE)) {
    String packerTypeStr=state.getProp(KAFKA_WORKUNIT_PACKER_TYPE);
    Optional<PackerType> packerType=Enums.getIfPresent(PackerType.class,packerTypeStr);
    if (packerType.isPresent()) {
      return getInstance(packerType.get(),source,state);
    }
 else {
      throw new IllegalArgumentException("WorkUnit packer type " + packerTypeStr + " not found");
    }
  }
 else {
    return getInstance(DEFAULT_PACKER_TYPE,source,state);
  }
}
