{
  closer.register(fileAwareInputStream.getInputStream());
  filesWritten++;
  TarArchiveInputStream tarIn=new TarArchiveInputStream(fileAwareInputStream.getInputStream());
  TarArchiveEntry tarEntry;
  String unArchivedRootName=null;
  try {
    while ((tarEntry=tarIn.getNextTarEntry()) != null) {
      Path tarEntryPath=new Path(this.stagingDir,tarEntry.getName());
      if (unArchivedRootName == null) {
        fileAwareInputStream.getFile().setDestination(tarEntryPath);
        unArchivedRootName=tarEntry.getName();
      }
      log.info("Unarchiving " + tarEntryPath);
      if (tarEntry.isDirectory() && !fs.exists(tarEntryPath)) {
        fs.mkdirs(tarEntryPath);
      }
 else {
        FSDataOutputStream out=fs.create(tarEntryPath,true);
        byte[] btoRead=new byte[1024];
        try {
          int len=0;
          while ((len=tarIn.read(btoRead)) != -1) {
            bytesWritten+=len;
            out.write(btoRead,0,len);
          }
        }
  finally {
          out.close();
          btoRead=null;
        }
      }
    }
  }
  finally {
    tarIn.close();
  }
  this.commit(fileAwareInputStream.getFile());
}
