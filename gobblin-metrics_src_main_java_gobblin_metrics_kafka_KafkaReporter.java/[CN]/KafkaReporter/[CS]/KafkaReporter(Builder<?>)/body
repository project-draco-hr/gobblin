{
  super(builder);
  this.topic=builder.topic;
  if (this.reportMetrics) {
    Properties props=new Properties();
    props.put("metadata.broker.list",builder.brokers);
    props.put("serializer.class","kafka.serializer.DefaultEncoder");
    props.put("request.required.acks","1");
    ProducerConfig config=new ProducerConfig(props);
    this.producerOpt=Optional.of(this.closer.register(new ProducerCloseable<String,byte[]>(config)));
  }
 else {
    this.producerOpt=Optional.absent();
  }
}
