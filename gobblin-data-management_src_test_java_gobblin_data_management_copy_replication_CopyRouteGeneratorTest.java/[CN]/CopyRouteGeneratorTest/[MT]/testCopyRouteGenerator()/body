{
  long unoWatermark=1475304606000L;
  long sourceWatermark=1475604606000L;
  ReplicaHadoopFsEndPoint holdemReplica=Mockito.mock(ReplicaHadoopFsEndPoint.class);
  Mockito.when(holdemReplica.isAvailable()).thenReturn(false);
  ReplicaHadoopFsEndPoint unoReplica=Mockito.mock(ReplicaHadoopFsEndPoint.class);
  Mockito.when(unoReplica.isAvailable()).thenReturn(true);
  Mockito.when(unoReplica.getWatermark()).thenReturn(new LongWatermark(unoWatermark));
  SourceHadoopFsEndPoint source=Mockito.mock(SourceHadoopFsEndPoint.class);
  Mockito.when(source.isAvailable()).thenReturn(true);
  Mockito.when(source.getWatermark()).thenReturn(new LongWatermark(sourceWatermark));
  ReplicaHadoopFsEndPoint warReplica=Mockito.mock(ReplicaHadoopFsEndPoint.class);
  Mockito.when(warReplica.isAvailable()).thenReturn(true);
  CopyRoute cp1=new CopyRoute(holdemReplica,warReplica);
  CopyRoute cp2=new CopyRoute(unoReplica,warReplica);
  CopyRoute cp3=new CopyRoute(source,warReplica);
  DataFlowTopology.DataFlowPath dataFlowPath=new DataFlowTopology.DataFlowPath(ImmutableList.<CopyRoute>of(cp1,cp2,cp3));
  DataFlowTopology dataFlowTopology=new DataFlowTopology();
  dataFlowTopology.addDataFlowPath(dataFlowPath);
  ReplicationConfiguration rc=Mockito.mock(ReplicationConfiguration.class);
  Mockito.when(rc.getCopyMode()).thenReturn(ReplicationCopyMode.PULL);
  Mockito.when(rc.getSource()).thenReturn(source);
  Mockito.when(rc.getReplicas()).thenReturn(ImmutableList.<EndPoint>of(holdemReplica,unoReplica,warReplica));
  Mockito.when(rc.getDataFlowToplogy()).thenReturn(dataFlowTopology);
  CopyRouteGeneratorOptimizedNetworkBandwidth network=new CopyRouteGeneratorOptimizedNetworkBandwidth();
  Assert.assertTrue(network.getPullRoute(rc,warReplica).get().getCopyFrom().equals(unoReplica));
  Assert.assertTrue(network.getPullRoute(rc,warReplica).get().getCopyFrom().getWatermark().compareTo(new LongWatermark(unoWatermark)) == 0);
  CopyRouteGeneratorOptimizedLatency latency=new CopyRouteGeneratorOptimizedLatency();
  Assert.assertTrue(latency.getPullRoute(rc,warReplica).get().getCopyFrom().equals(source));
  Assert.assertTrue(latency.getPullRoute(rc,warReplica).get().getCopyFrom().getWatermark().compareTo(new LongWatermark(sourceWatermark)) == 0);
}
