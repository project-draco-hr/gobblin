{
  String name=null;
  if (this.props.contains(nameKey)) {
    name=this.props.getProp(nameKey);
  }
 else   if (pattern.isPresent()) {
    name=pattern.get().matcher(path.toString()).group();
  }
 else {
    throw new IllegalStateException("Missing required property " + nameKey + " or "+ regexKey);
  }
  name=name.toLowerCase();
  if (this.sanitizeNameAllowed && !isNameValid(name)) {
    name=sanitizeName(name);
  }
  if (isNameValid(name)) {
    return name;
  }
  throw new IllegalStateException(name + " is not a valid Hive database or table name");
}
