{
  Map<String,JobState.DatasetState> datasetStatesByUrns=this.jobState.getDatasetStatesByUrns();
  for (  Map.Entry<String,JobState.DatasetState> entry : datasetStatesByUrns.entrySet()) {
    setFinalDatasetState(entry.getValue());
    if (canCommitDataset(this.jobCommitPolicy,entry.getValue())) {
      try {
        commitDataset(entry.getValue());
      }
  finally {
        persistDatasetState(entry.getKey(),entry.getValue());
      }
    }
  }
}
