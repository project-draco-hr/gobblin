{
  this.datasetStatesByUrns=Optional.of(this.jobState.createDatasetStatesByUrns());
  boolean allDatasetsCommit=true;
  boolean shouldCommitDataInJob=shouldCommitDataInJob(this.jobState);
  DeliverySemantics deliverySemantics=DeliverySemantics.parse(this.jobState);
  if (!shouldCommitDataInJob) {
    this.logger.info("Job will not commit data since data are committed by tasks.");
  }
  for (  Map.Entry<String,JobState.DatasetState> entry : this.datasetStatesByUrns.get().entrySet()) {
    allDatasetsCommit&=processDatasetCommit(shouldCommitDataInJob,deliverySemantics,entry.getKey(),entry.getValue());
  }
  if (!allDatasetsCommit) {
    this.jobState.setState(JobState.RunningState.FAILED);
    throw new IOException("Failed to commit dataset state for some dataset(s) of job " + this.jobId);
  }
  this.jobState.setState(JobState.RunningState.COMMITTED);
}
